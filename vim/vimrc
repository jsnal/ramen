" Set options
set autoindent
set backspace=indent,start,eol
set completeopt=menu,menuone,noselect
set expandtab
set formatoptions=tcqjn
if executable('rg')
    set grepprg=rg\ -H\ --no-heading\ --vimgrep
    set grepformat=%f:%l:%c:%m
endif
set hidden
set ignorecase
set nojoinspaces
set linebreak
set list
set listchars=tab:>\\\x20
set mouse=a
set ruler
set scrolloff=3
set shiftwidth=4
set shortmess=fixtmToO
set noshowcmd
set signcolumn=no
set smartcase
set smarttab
set splitbelow
set splitright
set noswapfile
set termwinkey=<C-X>
set textwidth=80
set title
set titlestring=%t\ -\ vim
set ttimeoutlen=1
set updatecount=0
set wildmode=longest:list,full
set nowrap
set nowritebackup

if has("gui_running")
    set guioptions=egmti
endif

" Set global leader key
let mapleader=','

" Set cursor shape
let &t_SI = "\e[6 q"
let &t_SR = "\e[4 q"
let &t_EI = "\e[2 q"

" Set colorscheme
if &t_Co > 2 || has("gui_running")
    syntax on
    colorscheme defaultpp
endif

" Detect the filetypes
filetype indent plugin on

" Easier window split movement
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l

" Intuitive movement
noremap j gj
noremap k gk

" Saving and quitting
nnoremap <Leader>q :q<CR>
nnoremap <Leader>w :w<CR>

" Quickly move lines up and down
xnoremap <silent> J :m'>+<CR>gv=gv
xnoremap <silent> K :m-2<CR>gv=gv

" Sensible popup menu keys
inoremap <silent><expr> <Tab> pumvisible() ? "\<C-n>" : "\<Tab>"
inoremap <silent><expr> <S-Tab> pumvisible() ? "\<C-p>" : "\<S-Tab>"
inoremap <silent><expr> <Enter> pumvisible() ? "\<C-y>" : "\<Enter>"

if has('autocmd')
    " Jump back to last known position on buffer open
    autocmd BufReadPost *
                \ if line("'\"") > 0 && line("'\"") <= line("$") |
                \     exe "normal! g`\"" |
                \ endif

    " Strip trailing whitespace on buffer write
    let s:whitespace_ignore = ['gitcommit', 'diff']
    autocmd BufWritePre * if index(s:whitespace_ignore, &ft) < 0 | %s/\s\+$//e

    " Change settings for plaintext writing
    autocmd Filetype gitcommit,markdown
                \ setlocal comments=b:*,b:-,b:+,n:> |
                \ setlocal conceallevel=0 |
                \ setlocal formatoptions=tjnr |
                \ setlocal shiftwidth=2 |
                \ setlocal tabstop=2
endif

